<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard Multi-ActivitÃ©s - Impact Associatif</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007bff">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  
  <!-- SPLASH SCREEN -->
  <div id="splash-screen">
    <div class="splash-inner">
      <h2>ğŸ“Š Dashboard Impact Multi-ActivitÃ©s</h2>
      <div class="loader"></div>
      <p id="splash-message">Chargement des donnÃ©es...</p>
    </div>
  </div>

  <!-- HEADER -->
  <header class="page-header">
    <div>
      <h1>ğŸ“Š Dashboard Impact Multi-ActivitÃ©s</h1>
      <p id="page-subtitle">Mesure d'impact associatif - 4 activitÃ©s</p>
    </div>

    <div class="top-actions">
      <div id="folder-status" class="status-box">
        <span class="status-indicator inactive"></span>
        <span class="status-text">Aucun dossier</span>
      </div>
      <button id="choose-folder" class="btn secondary">ğŸ“ Choisir dossier projet</button>
      <button id="process-data" class="btn success" disabled>âš™ï¸ Traiter les CSV</button>
      <button id="open-questionnaire" class="btn primary" disabled>ğŸ“ Nouveau questionnaire</button>
      <button id="export-report" class="btn secondary" disabled>ğŸ’¾ Exporter PDF</button>
      <button id="open-display-options" class="btn secondary">âš™ï¸ PrÃ©fÃ©rences</button>
    </div>
  </header>

  <!-- CONTRÃ”LES -->
  <div class="controls">
    <div class="controls-row">
      <label for="activity-selector">ğŸŒ ActivitÃ© :</label>
      <select id="activity-selector" disabled>
          <option value="all">Chargement...</option>
      </select>
      
      <label for="search-remarks">ğŸ” Remarques :</label>
      <input type="text" id="search-remarks" placeholder="Rechercher un mot clÃ©..." />

      <label>
        <input type="checkbox" id="filter-hidden-remarks" /> Masquer remarques cachÃ©es
      </label>
    </div>
  </div>

  <!-- CONTENU PRINCIPAL -->
  <main class="dashboard-grid">
    
    <!-- SECTION KPI UNIVERSELS -->
    <section class="card kpi-card full-width" id="section-kpis-universal">
      <h3>â­ Indicateurs ClÃ©s de Performance (Transversaux)</h3>
      <div id="universal-kpis-container" class="kpi-grid">â€”</div>
    </section>

    <!-- SECTION COMPARAISON -->
    <section class="card chart-card full-width" id="section-comparison">
      <h3>ğŸ“Š Comparaison des activitÃ©s</h3>
      <div id="comparison-charts-container">
        <p class="text-center mt-10">SÃ©lectionnez "Vue Globale" pour la comparaison.</p>
      </div>
    </section>
    
    <!-- SECTION Ã‰VOLUTION DES COMPÃ‰TENCES -->
    <section class="card full-width" id="specific-charts-container">
      <h3>ğŸ“ˆ Ã‰volution des CompÃ©tences (Avant/AprÃ¨s)</h3>
      <div id="evolution-charts-container" class="chart-grid">
        <p class="text-center mt-10">Chargement des graphiques...</p>
      </div>
    </section>
    
    <!-- SECTION DÃ‰MOGRAPHIE -->
    <section class="card chart-card full-width" id="section-demographics">
      <h3>ğŸ‘¥ DÃ©mographie & Profils</h3>
      <div id="demographics-container" class="chart-grid">
        <p class="text-center mt-10">Chargement des donnÃ©es...</p>
      </div>
    </section>
    
    <!-- SECTION REMARQUES -->
    <section class="card full-width" id="section-remarques">
      <h3>ğŸ’¬ Remarques & Commentaires (<span id="remarques-count">0</span>)</h3>
      <ul id="remarques-list" class="remarks-list">
        <li>Pas de remarques Ã  afficher.</li>
      </ul>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="page-footer">
    <button type="button" class="btn secondary" id="reload-data" disabled>ğŸ”„ Recharger les DonnÃ©es</button>
    <div>DerniÃ¨re mise Ã  jour: <span id="last-update">â€”</span></div>
  </footer>

  <!-- MODAL QUESTIONNAIRE -->
  <div id="questionnaire-modal" class="modal">
    <div class="modal-content">
      <h2>ğŸ“ Nouveau Questionnaire</h2>
      <p class="muted">Redirigez vers <a href="questionnaire.html" target="_blank">questionnaire.html</a> pour la saisie multi-activitÃ©s.</p>
      <div class="modal-actions">
        <button type="button" class="btn secondary" id="close-modal">Fermer</button>
        <a href="questionnaire.html" target="_blank" class="btn success">Ouvrir le Questionnaire</a>
      </div>
    </div>
  </div>

  
<!-- MODAL OPTIONS D'AFFICHAGE - VERSION CORRIGÃ‰E -->
<div id="display-options-modal" class="modal">
  <div class="modal-content modal-large">
    <h2>âš™ï¸ PrÃ©fÃ©rences d'Affichage</h2>
    <p class="muted">Personnalisez les Ã©lÃ©ments visibles dans votre dashboard. Toutes les prÃ©fÃ©rences sont sauvegardÃ©es automatiquement.</p>
    
    <div id="display-options-form">
      
      <!-- === SECTION KPI (LISTE PLATE) === -->
      <div class="preference-section">
        <h3>ğŸ“Š Indicateurs ClÃ©s (KPI)</h3>
        <div class="display-option-group">
          
          <!-- KPIs PRINCIPAUX -->
          <label>
            <input type="checkbox" id="opt-satisfaction-moy" name="satisfaction-moy" checked>
            <span class="label-text">
              <strong>Satisfaction Moyenne</strong>
              <small>Score moyen de satisfaction globale sur 5</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-nps" name="nps" checked>
            <span class="label-text">
              <strong>Net Promoter Score (NPS)</strong>
              <small>Indicateur de recommandation (% promoteurs - dÃ©tracteurs)</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-autonomie" name="autonomie" checked>
            <span class="label-text">
              <strong>Progression Autonomie</strong>
              <small>Ã‰volution de l'autonomie perÃ§ue entre avant et aprÃ¨s</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-confiance" name="confiance" checked>
            <span class="label-text">
              <strong>Progression Confiance en Soi</strong>
              <small>Ã‰volution de la confiance en soi entre avant et aprÃ¨s</small>
            </span>
          </label>
          
          <!-- KPIs DÃ‰TAILLÃ‰S -->
          <label>
            <input type="checkbox" id="opt-satisfaction-rate" name="satisfaction-rate" checked>
            <span class="label-text">
              <strong>Taux de Satisfaction (â‰¥4/5)</strong>
              <small>Pourcentage de participants satisfaits ou trÃ¨s satisfaits</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-non-response-rate" name="non-response-rate" checked>
            <span class="label-text">
              <strong>Taux de DonnÃ©es Manquantes</strong>
              <small>Pourcentage de rÃ©ponses incomplÃ¨tes ou invalides</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-data-age" name="data-age" checked>
            <span class="label-text">
              <strong>AnciennetÃ© Moyenne des DonnÃ©es</strong>
              <small>Ã‚ge moyen des rÃ©ponses en jours</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-quality-engagement" name="quality-engagement" checked>
            <span class="label-text">
              <strong>Taux d'Engagement Qualitatif</strong>
              <small>Pourcentage de participants ayant laissÃ© des remarques</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-comment-depth" name="comment-depth" checked>
            <span class="label-text">
              <strong>Profondeur Moyenne des Remarques</strong>
              <small>Nombre moyen de caractÃ¨res par remarque</small>
            </span>
          </label>
        </div>
      </div>

      <!-- === SECTION DÃ‰MOGRAPHIE === -->
      <div class="preference-section">
        <h3>ğŸ‘¥ DÃ©mographie & Profils</h3>
        <div class="display-option-group">
          <label>
            <input type="checkbox" id="opt-age" name="age" checked>
            <span class="label-text">
              <strong>Distribution par Ã‚ge</strong>
              <small>RÃ©partition des participants par tranches d'Ã¢ge</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-gender" name="gender" checked>
            <span class="label-text">
              <strong>Distribution par Genre</strong>
              <small>RÃ©partition FÃ©minin / Masculin / Non-genrÃ© / Autre</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-origin" name="origin" checked>
            <span class="label-text">
              <strong>Distribution par Origine</strong>
              <small>RÃ©partition UE / Hors UE / PrÃ©fÃ¨re ne pas rÃ©pondre</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-professional-status" name="professional-status" checked>
            <span class="label-text">
              <strong>Distribution par Statut Professionnel</strong>
              <small>EmployÃ©, IndÃ©pendant, Ã‰tudiant, RetraitÃ©, Sans emploi</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-education-level" name="education-level" checked>
            <span class="label-text">
              <strong>Distribution par Niveau d'Ã‰tudes</strong>
              <small>Primaire, Secondaire, Universitaire (Licence/Master)</small>
            </span>
          </label>
        </div>
      </div>

      <!-- === SECTION ANALYSE === -->
      <div class="preference-section">
        <h3>ğŸ“ˆ Graphiques d'Analyse</h3>
        <div class="display-option-group">
          <label>
            <input type="checkbox" id="opt-comparison" name="comparison" checked>
            <span class="label-text">
              <strong>Comparaison des ActivitÃ©s (Avant/AprÃ¨s)</strong>
              <small>Graphique comparatif de l'Ã©volution des compÃ©tences (Vue Globale uniquement)</small>
            </span>
          </label>
          
          <label>
            <input type="checkbox" id="opt-evolution" name="evolution" checked>
            <span class="label-text">
              <strong>Ã‰volution DÃ©taillÃ©e des CompÃ©tences</strong>
              <small>Graphiques individuels par indicateur (Vue ActivitÃ© uniquement)</small>
            </span>
          </label>
        </div>
      </div>

      <!-- === SECTION REMARQUES === -->
      <div class="preference-section">
        <h3>ğŸ’¬ DonnÃ©es Qualitatives</h3>
        <div class="display-option-group">
          <label>
            <input type="checkbox" id="opt-remarks" name="remarks" checked>
            <span class="label-text">
              <strong>Afficher la Section Remarques et Commentaires</strong>
              <small>Tous les commentaires ouverts des participants</small>
            </span>
          </label>
        </div>
      </div>

    </div>

    <div class="modal-actions">
      <button type="button" class="btn secondary" id="cancel-display-options">Annuler</button>
      <button type="button" class="btn primary" id="save-display-options">âœ“ Appliquer et Sauvegarder</button>
    </div>
  </div>
</div>

  <script src="config.js"></script>
  <script src="dashboard.js"></script>
</body>
</html>